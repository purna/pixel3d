<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pixel 3D - Pro Staging Studio</title>
    <!-- Fonts & Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <style type="text/css">@font-face {font-family:Inter;font-style:normal;font-weight:400;src:url(/cf-fonts/v/inter/5.0.16/cyrillic-ext/wght/normal.woff2);unicode-range:U+0460-052F,U+1C80-1C88,U+20B4,U+2DE0-2DFF,U+A640-A69F,U+FE2E-FE2F;font-display:swap;}@font-face {font-family:Inter;font-style:normal;font-weight:400;src:url(/cf-fonts/v/inter/5.0.16/latin/wght/normal.woff2);unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+0304,U+0308,U+0329,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD;font-display:swap;}@font-face {font-family:Inter;font-style:normal;font-weight:400;src:url(/cf-fonts/v/inter/5.0.16/greek/wght/normal.woff2);unicode-range:U+0370-03FF;font-display:swap;}@font-face {font-family:Inter;font-style:normal;font-weight:400;src:url(/cf-fonts/v/inter/5.0.16/greek-ext/wght/normal.woff2);unicode-range:U+1F00-1FFF;font-display:swap;}@font-face {font-family:Inter;font-style:normal;font-weight:400;src:url(/cf-fonts/v/inter/5.0.16/cyrillic/wght/normal.woff2);unicode-range:U+0301,U+0400-045F,U+0490-0491,U+04B0-04B1,U+2116;font-display:swap;}@font-face {font-family:Inter;font-style:normal;font-weight:400;src:url(/cf-fonts/v/inter/5.0.16/latin-ext/wght/normal.woff2);unicode-range:U+0100-02AF,U+0304,U+0308,U+0329,U+1E00-1E9F,U+1EF2-1EFF,U+2020,U+20A0-20AB,U+20AD-20CF,U+2113,U+2C60-2C7F,U+A720-A7FF;font-display:swap;}@font-face {font-family:Inter;font-style:normal;font-weight:400;src:url(/cf-fonts/v/inter/5.0.16/vietnamese/wght/normal.woff2);unicode-range:U+0102-0103,U+0110-0111,U+0128-0129,U+0168-0169,U+01A0-01A1,U+01AF-01B0,U+0300-0301,U+0303-0304,U+0308-0309,U+0323,U+0329,U+1EA0-1EF9,U+20AB;font-display:swap;}@font-face {font-family:Inter;font-style:normal;font-weight:500;src:url(/cf-fonts/v/inter/5.0.16/cyrillic/wght/normal.woff2);unicode-range:U+0301,U+0400-045F,U+0490-0491,U+04B0-04B1,U+2116;font-display:swap;}@font-face {font-family:Inter;font-style:normal;font-weight:500;src:url(/cf-fonts/v/inter/5.0.16/latin-ext/wght/normal.woff2);unicode-range:U+0100-02AF,U+0304,U+0308,U+0329,U+1E00-1E9F,U+1EF2-1EFF,U+2020,U+20A0-20AB,U+20AD-20CF,U+2113,U+2C60-2C7F,U+A720-A7FF;font-display:swap;}@font-face {font-family:Inter;font-style:normal;font-weight:500;src:url(/cf-fonts/v/inter/5.0.16/vietnamese/wght/normal.woff2);unicode-range:U+0102-0103,U+0110-0111,U+0128-0129,U+0168-0169,U+01A0-01A1,U+01AF-01B0,U+0300-0301,U+0303-0304,U+0308-0309,U+0323,U+0329,U+1EA0-1EF9,U+20AB;font-display:swap;}@font-face {font-family:Inter;font-style:normal;font-weight:500;src:url(/cf-fonts/v/inter/5.0.16/greek-ext/wght/normal.woff2);unicode-range:U+1F00-1FFF;font-display:swap;}@font-face {font-family:Inter;font-style:normal;font-weight:500;src:url(/cf-fonts/v/inter/5.0.16/latin/wght/normal.woff2);unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+0304,U+0308,U+0329,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD;font-display:swap;}@font-face {font-family:Inter;font-style:normal;font-weight:500;src:url(/cf-fonts/v/inter/5.0.16/greek/wght/normal.woff2);unicode-range:U+0370-03FF;font-display:swap;}@font-face {font-family:Inter;font-style:normal;font-weight:500;src:url(/cf-fonts/v/inter/5.0.16/cyrillic-ext/wght/normal.woff2);unicode-range:U+0460-052F,U+1C80-1C88,U+20B4,U+2DE0-2DFF,U+A640-A69F,U+FE2E-FE2F;font-display:swap;}@font-face {font-family:Inter;font-style:normal;font-weight:600;src:url(/cf-fonts/v/inter/5.0.16/greek-ext/wght/normal.woff2);unicode-range:U+1F00-1FFF;font-display:swap;}@font-face {font-family:Inter;font-style:normal;font-weight:600;src:url(/cf-fonts/v/inter/5.0.16/cyrillic/wght/normal.woff2);unicode-range:U+0301,U+0400-045F,U+0490-0491,U+04B0-04B1,U+2116;font-display:swap;}@font-face {font-family:Inter;font-style:normal;font-weight:600;src:url(/cf-fonts/v/inter/5.0.16/cyrillic-ext/wght/normal.woff2);unicode-range:U+0460-052F,U+1C80-1C88,U+20B4,U+2DE0-2DFF,U+A640-A69F,U+FE2E-FE2F;font-display:swap;}@font-face {font-family:Inter;font-style:normal;font-weight:600;src:url(/cf-fonts/v/inter/5.0.16/latin-ext/wght/normal.woff2);unicode-range:U+0100-02AF,U+0304,U+0308,U+0329,U+1E00-1E9F,U+1EF2-1EFF,U+2020,U+20A0-20AB,U+20AD-20CF,U+2113,U+2C60-2C7F,U+A720-A7FF;font-display:swap;}@font-face {font-family:Inter;font-style:normal;font-weight:600;src:url(/cf-fonts/v/inter/5.0.16/vietnamese/wght/normal.woff2);unicode-range:U+0102-0103,U+0110-0111,U+0128-0129,U+0168-0169,U+01A0-01A1,U+01AF-01B0,U+0300-0301,U+0303-0304,U+0308-0309,U+0323,U+0329,U+1EA0-1EF9,U+20AB;font-display:swap;}@font-face {font-family:Inter;font-style:normal;font-weight:600;src:url(/cf-fonts/v/inter/5.0.16/greek/wght/normal.woff2);unicode-range:U+0370-03FF;font-display:swap;}@font-face {font-family:Inter;font-style:normal;font-weight:600;src:url(/cf-fonts/v/inter/5.0.16/latin/wght/normal.woff2);unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+0304,U+0308,U+0329,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD;font-display:swap;}@font-face {font-family:Inter;font-style:normal;font-weight:700;src:url(/cf-fonts/v/inter/5.0.16/cyrillic/wght/normal.woff2);unicode-range:U+0301,U+0400-045F,U+0490-0491,U+04B0-04B1,U+2116;font-display:swap;}@font-face {font-family:Inter;font-style:normal;font-weight:700;src:url(/cf-fonts/v/inter/5.0.16/latin/wght/normal.woff2);unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+0304,U+0308,U+0329,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD;font-display:swap;}@font-face {font-family:Inter;font-style:normal;font-weight:700;src:url(/cf-fonts/v/inter/5.0.16/vietnamese/wght/normal.woff2);unicode-range:U+0102-0103,U+0110-0111,U+0128-0129,U+0168-0169,U+01A0-01A1,U+01AF-01B0,U+0300-0301,U+0303-0304,U+0308-0309,U+0323,U+0329,U+1EA0-1EF9,U+20AB;font-display:swap;}@font-face {font-family:Inter;font-style:normal;font-weight:700;src:url(/cf-fonts/v/inter/5.0.16/cyrillic-ext/wght/normal.woff2);unicode-range:U+0460-052F,U+1C80-1C88,U+20B4,U+2DE0-2DFF,U+A640-A69F,U+FE2E-FE2F;font-display:swap;}@font-face {font-family:Inter;font-style:normal;font-weight:700;src:url(/cf-fonts/v/inter/5.0.16/greek-ext/wght/normal.woff2);unicode-range:U+1F00-1FFF;font-display:swap;}@font-face {font-family:Inter;font-style:normal;font-weight:700;src:url(/cf-fonts/v/inter/5.0.16/greek/wght/normal.woff2);unicode-range:U+0370-03FF;font-display:swap;}@font-face {font-family:Inter;font-style:normal;font-weight:700;src:url(/cf-fonts/v/inter/5.0.16/latin-ext/wght/normal.woff2);unicode-range:U+0100-02AF,U+0304,U+0308,U+0329,U+1E00-1E9F,U+1EF2-1EFF,U+2020,U+20A0-20AB,U+20AD-20CF,U+2113,U+2C60-2C7F,U+A720-A7FF;font-display:swap;}</style>
    
    <!-- External Styles -->
    <link rel="stylesheet" href="css/styles.css">

    <!-- Three.js Import Map -->
    <script type="importmap">
        {
            "imports": {
                "three": "https://cdn.jsdelivr.net/npm/three@0.160.0/build/three.module.js",
                "three/addons/": "https://cdn.jsdelivr.net/npm/three@0.160.0/examples/jsm/"
            }
        }
    </script>
</head>
<body>

    <!-- HEADER -->
    <header>
        <div class="logo-area">
            <h1>Pixel 3D</h1>
            <span class="badge">Pro Staging Studio V1.0</span>
        </div>
        <div class="header-controls">
            <button class="btn" id="btn-clear"><i class="fas fa-trash-alt"></i> Clear</button>
            <input type="file" id="file-input" accept=".json" style="display:none">
            <button class="btn" id="btn-load"><i class="fas fa-folder-open"></i> Load</button>
            <button class="btn primary" id="btn-save"><i class="fas fa-save"></i> Save</button>
        </div>
    </header>

    <!-- WORKSPACE -->
    <div class="workspace">
        
           <!-- LEFT TOOLBAR -->
        <div class="tools-panel" id="tools-container">
            <div class="tool-btn active" id="tool-select" data-tooltip="**Select Tool**
Click objects to select them
--Keyboard: Q--"><i class="fas fa-mouse-pointer"></i></div>
            <div class="tool-divider"></div>
            
            <!-- AI Tools -->
            <div class="tool-btn ai-tool" id="tool-ai-scene" data-tooltip="**Magic Scene Generator**
Describe a scene and let AI create it
Uses Gemini AI for generation"><i class="fas fa-wand-magic-sparkles"></i></div>
            
            <div class="tool-divider"></div>

            <!-- Shapes Menu -->
            <div class="tool-btn menu-parent" data-tooltip="**Shapes**
Hover to see all available shapes">
                <i class="fas fa-shapes"></i>
                <div class="tool-submenu">
                    <div class="tool-btn" data-action="addShape" data-type="box" data-tooltip="**Box**"><i class="fas fa-cube"></i></div>
                    <div class="tool-btn" data-action="addShape" data-type="sphere" data-tooltip="**Sphere**"><i class="fas fa-circle"></i></div>
                    <div class="tool-btn" data-action="addShape" data-type="cone" data-tooltip="**Cone**"><i class="fas fa-caret-up"></i></div>
                    <div class="tool-btn" data-action="addShape" data-type="cylinder" data-tooltip="**Cylinder**"><i class="fas fa-database"></i></div>
                    <div class="tool-btn" data-action="addShape" data-type="plane" data-tooltip="**Plane**
Great for floors"><i class="fas fa-vector-square"></i></div>
                    <div class="tool-btn" data-action="addShape" data-type="torus" data-tooltip="**Torus**
Donut shape"><i class="fas fa-life-ring"></i></div>
                    <div class="tool-btn" data-action="addShape" data-type="tetrahedron" data-tooltip="**Tetrahedron**"><i class="fas fa-gem"></i></div>
                    <div class="tool-btn" data-action="addShape" data-type="octahedron" data-tooltip="**Octahedron**"><i class="fas fa-dice-d8"></i></div>
                    <div class="tool-btn" data-action="addShape" data-type="dodecahedron" data-tooltip="**Dodecahedron**"><i class="fas fa-dice-d20"></i></div>
                    <div class="tool-btn" data-action="addShape" data-type="icosahedron" data-tooltip="**Icosahedron**"><i class="fas fa-star"></i></div>
                    <div class="tool-btn" data-action="addShape" data-type="torusknot" data-tooltip="**Torus Knot**
Complex twisted shape"><i class="fas fa-bezier-curve"></i></div>
                </div>
            </div>
            
            <!-- Characters Menu -->
            <div class="tool-btn menu-parent" data-tooltip="**Characters**
Add poseable human figures">
                <i class="fas fa-user"></i>
                <div class="tool-submenu">
                    <div class="tool-btn" data-action="addFigure" data-type="male" data-tooltip="**Male Figure**
Fully poseable with joints"><i class="fas fa-male"></i></div>
                    <div class="tool-btn" data-action="addFigure" data-type="female" data-tooltip="**Female Figure**
Fully poseable with joints"><i class="fas fa-female"></i></div>
                </div>
            </div>

            <!-- Lights Menu -->
            <div class="tool-btn menu-parent" data-tooltip="**Lights**
Illuminate your scene">
                <i class="fas fa-lightbulb"></i>
                <div class="tool-submenu">
                    <div class="tool-btn" data-action="addLight" data-type="point" data-tooltip="**Point Light**
Radiates in all directions"><i class="far fa-lightbulb"></i></div>
                    <div class="tool-btn" data-action="addLight" data-type="spot" data-tooltip="**Spot Light**
Focused beam of light"><i class="fas fa-bullseye"></i></div>
                    <div class="tool-btn" data-action="addLight" data-type="directional" data-tooltip="**Directional Light**
Like sunlight, parallel rays"><i class="fas fa-sun"></i></div>
                    <div class="tool-btn" data-action="addLight" data-type="ambient" data-tooltip="**Ambient Light**
Overall scene lighting"><i class="fas fa-globe"></i></div>
                    <div class="tool-btn" data-action="addLight" data-type="hemisphere" data-tooltip="**Hemisphere Light**
Sky and ground lighting"><i class="fas fa-adjust"></i></div>
                </div>
            </div>
            
            <!-- Settings at bottom -->
            <div style="margin-top: auto;"></div>
            <div class="tool-divider"></div>
            <div class="tool-btn" id="tool-settings" data-tooltip="**Settings**
Configure application"><i class="fas fa-cog"></i></div>
        </div>

        
        <!-- CENTER CANVAS -->
        <div class="canvas-area">
            <div class="overlay-controls">
                <button class="btn icon-only" id="mode-translate" title="Translate (G)" data-tooltip="**Translate Mode**
Move objects in 3D space
--Keyboard: G--"><i class="fas fa-arrows-alt"></i></button>
                <button class="btn icon-only" id="mode-rotate" title="Rotate (R)" data-tooltip="**Rotate Mode**
Rotate objects around axes
--Keyboard: R--"><i class="fas fa-sync-alt"></i></button>
                <button class="btn icon-only" id="mode-scale" title="Scale (S)" data-tooltip="**Scale Mode**
Resize objects
--Keyboard: S--"><i class="fas fa-expand-arrows-alt"></i></button>
            </div>
            <div id="canvas-container" style="width: 100%; height: 100%;"></div>
        </div>

        <!-- Floating Toggle -->
        <div id="panel-toggle" title="Toggle Panel">
            <i class="fas fa-chevron-right"></i>
        </div>

        <!-- RIGHT PROPERTIES PANEL -->
        <div class="properties-panel" id="properties-panel">
            <div class="panel-header">
                <div class="panel-header-title"><i class="fas fa-layer-group"></i> Scene Objects</div>
            </div>
            
            <!-- LAYERS LIST (Managed by LayerManager.js) -->
            <div id="layers-list" class="layers-container">
                <!-- Layer items will be injected here dynamically -->
            </div>
            
            <div class="panel-header" style="border-top:1px solid var(--border-color);">
                <div class="panel-header-title"><i class="fas fa-sliders-h"></i> Properties</div>
            </div>
            <div id="props-content" class="panel-content">
                <div class="empty-state">Select an object to edit properties</div>
            </div>
        </div>

    </div>

    <!-- AI MODAL -->
    <div class="modal-overlay" id="ai-modal">
        <div class="modal">
            <div class="modal-title">
                <i class="fas fa-sparkles"></i> <span id="modal-title-text">Magic Scene Generator</span>
            </div>
            <div style="font-size:0.8rem; color:#94a3b8; margin-bottom:10px;" id="modal-desc">
                Describe the scene you want to build.
            </div>
            <textarea id="ai-prompt-input" placeholder="e.g. A circle of blue boxes with a red sphere in the middle..."></textarea>
            <div class="modal-actions">
                <div class="loading-spinner" id="ai-spinner"><i class="fas fa-circle-notch fa-spin"></i> Generating...</div>
                <button class="btn" id="btn-ai-cancel">Cancel</button>
                <button class="btn ai-magic" id="btn-ai-generate">Generate âœ¨</button>
            </div>
        </div>
    </div>

    <!-- SETTINGS MODAL -->
    <div class="modal-overlay" id="settings-modal">
        <div class="modal">
            <div class="modal-title">
                <i class="fas fa-cog"></i> Settings
            </div>
            <div style="font-size:0.8rem; color:#94a3b8; margin-bottom:15px;">
                Configure your 3D Studio preferences
            </div>
            <div class="settings-content">
                <div class="property-group">
                    <label class="property-label">
                        <input type="checkbox" id="setting-grid" checked>
                        Show Grid
                    </label>
                </div>
                <div class="property-group">
                    <label class="property-label">
                        <input type="checkbox" id="setting-axes" checked>
                        Show Axes
                    </label>
                </div>
                <div class="property-group">
                    <label class="property-label">
                        <input type="checkbox" id="setting-snap" checked>
                        Snap to Grid
                    </label>
                </div>
                <div class="property-group">
                    <label class="property-label">
                        <input type="checkbox" id="setting-tooltips" checked>
                        Show Tooltips
                    </label>
                </div>
                <div class="property-group">
                    <label class="property-label">
                        <input type="range" id="setting-camera-speed" min="0.1" max="5" step="0.1" value="1">
                        Camera Speed: <span id="camera-speed-value">1.0</span>
                    </label>
                </div>
            </div>
            <div class="modal-actions">
                <button class="btn" id="btn-settings-reset">Reset</button>
                <button class="btn" id="btn-settings-close">Close</button>
                <button class="btn primary" id="btn-settings-save">Save Settings</button>
            </div>
        </div>
    </div>

    <!-- MAIN APP ENTRY POINT -->
    <script type="module" src="js/main.js"></script>
</html>